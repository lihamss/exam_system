# 在线考试系统 - 数据库与功能说明

## 一、数据库表结构与关系

### 1.1 ER 关系概览

```
┌─────────┐     ┌──────────────┐     ┌─────────┐     ┌──────────────┐     ┌─────────┐
│  user   │────<│ exam_record  │>────│  exam   │────>│    paper     │<────│question │
└─────────┘     └──────────────┘     └─────────┘     └──────────────┘     └─────────┘
                      │                     │                │                    │
                      │                     │                └────────────────────┘
                      │                     │                   paper_question
                      v                     │
               ┌──────────────┐              │
               │answer_record │              │
               └──────────────┘              │
                      │                      │
                      └──────────────────────┘
                            (通过 question_id 关联)

┌─────────┐
│ notice  │  （独立表，系统公告）
└─────────┘
```

### 1.2 表说明

| 表名 | 说明 | 主要字段 |
|------|------|----------|
| **user** | 用户表 | id, username, password, role(student/teacher/admin), real_name, avatar, create_time |
| **question** | 题目表 | id, type(single/multiple/judge/fill/short), content, option_a~d, correct_answer, score, difficulty, subject |
| **paper** | 试卷表 | id, name, total_score, duration, create_time |
| **paper_question** | 试卷-题目关联表 | id, paper_id, question_id, score（该题在试卷中的分值） |
| **exam** | 考试表 | id, paper_id, name, start_time, end_time, status(draft/published/ended), shuffle, show_answer, allow_retake |
| **exam_record** | 考试记录表 | id, user_id, exam_id, total_score, start_time, submit_time, grade_status |
| **answer_record** | 答题记录表 | id, exam_record_id, question_id, user_answer, score |
| **notice** | 系统公告表 | id, title, content, create_time |

### 1.3 表关系详解

- **user → exam_record**：一对多。一个用户可有多条考试记录。
- **exam → exam_record**：一对多。一场考试可被多人参加，每人一条记录。
- **exam_record → answer_record**：一对多。一条考试记录对应多道题的答题记录。
- **question → answer_record**：一对多。一道题可出现在多条答题记录中（不同考生）。
- **exam → paper**：多对一。一场考试使用一份试卷。
- **paper ↔ question**：多对多，通过 **paper_question** 关联。一份试卷包含多道题，一道题可被多份试卷引用；paper_question 中的 score 表示该题在该试卷中的分值。
- **notice**：独立表，与业务无外键关联。

### 1.4 题型与评分

| type | 含义 | 选项字段 | 正确答案格式 | 评分方式 |
|------|------|----------|--------------|----------|
| single | 单选题 | option_a~d | A/B/C/D | 自动 |
| multiple | 多选题 | option_a~d | A,B,C（逗号分隔） | 自动 |
| judge | 判断题 | 无 | T/F | 自动 |
| fill | 填空题 | 无 | 标准答案文本 | 教师批改 |
| short | 简答题 | 无 | 参考答案（可选） | 教师批改 |

---

## 二、项目已实现功能

### 2.1 学生端

| 功能模块 | 实现情况 | 说明 |
|----------|----------|------|
| **首页** | ✅ | 系统公告、可参加考试、最近成绩 |
| **考试中心** | ✅ | 可参加考试列表、开始考试、进入答题页 |
| **在线答题** | ✅ | 单选/多选/判断/填空/简答、倒计时、超时自动交卷、提交 |
| **我的考试** | ✅ | 考试记录列表、进行中/已交卷状态、继续答题/查看成绩 |
| **成绩查询** | ✅ | 成绩列表、单场详情（各题得分、用户答案） |
| **个人中心** | ✅ | 修改姓名、修改密码 |
| **帮助中心** | ✅ | 使用说明、常见问题、联系方式 |
| **注册** | ✅ | 学生自助注册，默认角色 student |

### 2.2 教师/管理员端

| 功能模块 | 实现情况 | 说明 |
|----------|----------|------|
| **控制台** | ✅ | 今日考试数、待批改数、试卷/题目统计、公告发布 |
| **考试管理** | ✅ | 创建/编辑/删除考试，设置时间、试卷、乱序、显示答案、补考 |
| **题库管理** | ✅ | 题目 CRUD，按题型/科目/难度筛选 |
| **用户管理** | ✅ | 用户 CRUD、重置密码、角色分配 |
| **成绩管理** | ✅ | 按考试查看答卷、批改主观题（填空、简答） |
| **试卷管理** | ✅ | 创建/编辑试卷、选题、设置每题分值、预览 |
| **系统设置** | ✅ | 公告管理（发布、删除） |

### 2.3 通用功能

| 功能 | 实现情况 |
|------|----------|
| 登录 / JWT 鉴权 | ✅ |
| 密码 BCrypt 加密 | ✅ |
| 角色权限（student/teacher/admin） | ✅ |
| 客观题自动评分 | ✅ |
| 主观题教师批改 | ✅ |
| 考试乱序 | ✅ |
| 一场考试仅参加一次（可配置补考） | ✅ |

---

## 三、模拟数据说明

### 3.1 演示账号（应用启动时自动创建）

| 用户名 | 密码 | 角色 |
|--------|------|------|
| admin | admin123 | 管理员 |
| teacher | 123456 | 教师 |
| student1 | 123456 | 学生 |
| student2 | 123456 | 学生 |

### 3.2 模拟业务数据（执行 sql/data.sql）

- **题目**：10 道（Java、数据库、前端、网络等）
- **试卷**：2 份（Java 基础测试、全栈开发综合测试）
- **考试**：3 场（2 场已发布可参加，1 场草稿）
- **公告**：3 条

### 3.3 数据导入顺序

1. 执行 `sql/schema.sql` 建库建表
2. 启动后端应用（自动创建 admin、teacher、student1、student2）
3. 执行 `sql/data.sql` 导入题目、试卷、考试、公告

---

## 四、技术实现要点

- **前后端分离**：Vue 3 + Vite 前端，Spring Boot RESTful API
- **鉴权**：Spring Security + JWT，请求头 `Authorization: Bearer <token>`
- **ORM**：MyBatis-Plus
- **自动评分**：单选/多选/判断题答案完全一致得满分，否则 0 分
- **主观题**：填空、简答由教师在「成绩管理」中批改并录入得分
